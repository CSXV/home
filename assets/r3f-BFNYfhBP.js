import{r as g,j as oe,c as Ue,R as Rn,a as On,b as R}from"./react-DSBgOPP-.js";import{W as In,R as Fn,O as Tn,P as An,S as kn,a as ft,V as Dn,b as Bn,B as _n,L as Nn,c as Zt,N as zn,A as Ln,d as kt,C as Hn,e as qn,U as Wn,f as ee,g as Un,h as Vn,i as Gn,T as Xn,M as Qn,j as Yn,Q as Ot,k as Kn,l as Dt,E as It,m as Zn,n as Jn,D as $n}from"./three-DQuK2cH5.js";import{c as eo,x as to,i as no,a as oo,m as ro,s as io}from"./vendor-CPN78QRH.js";import{Vector3 as pt,EventQueue as so,RigidBodyDesc as ao,ColliderDesc as lo,ActiveEvents as Le}from"./rapier-BodjHcp2.js";var Zr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function $r(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var n=function o(){var r=!1;try{r=this instanceof o}catch{}return r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(o){var r=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(n,o,r.get?r:{enumerable:!0,get:function(){return e[o]}})}),n}const co="modulepreload",uo=function(e){return"/home/"+e},Bt={},fo=function(t,n,o){let r=Promise.resolve();if(n&&n.length>0){let s=function(u){return Promise.all(u.map(l=>Promise.resolve(l).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),a=c?.nonce||c?.getAttribute("nonce");r=s(n.map(u=>{if(u=uo(u),u in Bt)return;Bt[u]=!0;const l=u.endsWith(".css"),d=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${d}`))return;const p=document.createElement("link");if(p.rel=l?"stylesheet":co,l||(p.as="script"),p.crossOrigin="",p.href=u,a&&p.setAttribute("nonce",a),document.head.appendChild(p),l)return new Promise((b,M)=>{p.addEventListener("load",b),p.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(c){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=c,window.dispatchEvent(a),!a.defaultPrevented)throw c}return r.then(c=>{for(const a of c||[])a.status==="rejected"&&i(a.reason);return t().catch(i)})};var vt={exports:{}},mt={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _t;function po(){return _t||(_t=1,function(e){function t(m,E){var j=m.length;m.push(E);e:for(;0<j;){var B=j-1>>>1,k=m[B];if(0<r(k,E))m[B]=E,m[j]=k,j=B;else break e}}function n(m){return m.length===0?null:m[0]}function o(m){if(m.length===0)return null;var E=m[0],j=m.pop();if(j!==E){m[0]=j;e:for(var B=0,k=m.length,S=k>>>1;B<S;){var A=2*(B+1)-1,X=m[A],z=A+1,Q=m[z];if(0>r(X,j))z<k&&0>r(Q,X)?(m[B]=Q,m[z]=j,B=z):(m[B]=X,m[A]=j,B=A);else if(z<k&&0>r(Q,j))m[B]=Q,m[z]=j,B=z;else break e}}return E}function r(m,E){var j=m.sortIndex-E.sortIndex;return j!==0?j:m.id-E.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var c=Date,a=c.now();e.unstable_now=function(){return c.now()-a}}var s=[],u=[],l=1,d=null,p=3,b=!1,M=!1,I=!1,C=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,f=typeof setImmediate<"u"?setImmediate:null;function y(m){for(var E=n(u);E!==null;){if(E.callback===null)o(u);else if(E.startTime<=m)o(u),E.sortIndex=E.expirationTime,t(s,E);else break;E=n(u)}}function x(m){if(I=!1,y(m),!M)if(n(s)!==null)M=!0,H();else{var E=n(u);E!==null&&G(x,E.startTime-m)}}var h=!1,P=-1,q=5,W=-1;function T(){return!(e.unstable_now()-W<q)}function _(){if(h){var m=e.unstable_now();W=m;var E=!0;try{e:{M=!1,I&&(I=!1,v(P),P=-1),b=!0;var j=p;try{t:{for(y(m),d=n(s);d!==null&&!(d.expirationTime>m&&T());){var B=d.callback;if(typeof B=="function"){d.callback=null,p=d.priorityLevel;var k=B(d.expirationTime<=m);if(m=e.unstable_now(),typeof k=="function"){d.callback=k,y(m),E=!0;break t}d===n(s)&&o(s),y(m)}else o(s);d=n(s)}if(d!==null)E=!0;else{var S=n(u);S!==null&&G(x,S.startTime-m),E=!1}}break e}finally{d=null,p=j,b=!1}E=void 0}}finally{E?D():h=!1}}}var D;if(typeof f=="function")D=function(){f(_)};else if(typeof MessageChannel<"u"){var L=new MessageChannel,O=L.port2;L.port1.onmessage=_,D=function(){O.postMessage(null)}}else D=function(){C(_,0)};function H(){h||(h=!0,D())}function G(m,E){P=C(function(){m(e.unstable_now())},E)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(m){m.callback=null},e.unstable_continueExecution=function(){M||b||(M=!0,H())},e.unstable_forceFrameRate=function(m){0>m||125<m?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):q=0<m?Math.floor(1e3/m):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_getFirstCallbackNode=function(){return n(s)},e.unstable_next=function(m){switch(p){case 1:case 2:case 3:var E=3;break;default:E=p}var j=p;p=E;try{return m()}finally{p=j}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(m,E){switch(m){case 1:case 2:case 3:case 4:case 5:break;default:m=3}var j=p;p=m;try{return E()}finally{p=j}},e.unstable_scheduleCallback=function(m,E,j){var B=e.unstable_now();switch(typeof j=="object"&&j!==null?(j=j.delay,j=typeof j=="number"&&0<j?B+j:B):j=B,m){case 1:var k=-1;break;case 2:k=250;break;case 5:k=1073741823;break;case 4:k=1e4;break;default:k=5e3}return k=j+k,m={id:l++,callback:E,priorityLevel:m,startTime:j,expirationTime:k,sortIndex:-1},j>B?(m.sortIndex=j,t(u,m),n(s)===null&&m===n(u)&&(I?(v(P),P=-1):I=!0,G(x,j-B))):(m.sortIndex=k,t(s,m),M||b||(M=!0,H())),m},e.unstable_shouldYield=T,e.unstable_wrapCallback=function(m){var E=p;return function(){var j=p;p=E;try{return m.apply(this,arguments)}finally{p=j}}}}(mt)),mt}var Nt;function vo(){return Nt||(Nt=1,vt.exports=po()),vt.exports}var zt=vo();function Jt(e){let t=e.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const $t=e=>e&&e.isOrthographicCamera,mo=e=>e&&e.hasOwnProperty("current"),go=e=>e!=null&&(typeof e=="string"||typeof e=="number"||e.isColor),Pe=((e,t)=>typeof window<"u"&&(((e=window.document)==null?void 0:e.createElement)||((t=window.navigator)==null?void 0:t.product)==="ReactNative"))()?g.useLayoutEffect:g.useEffect;function en(e){const t=g.useRef(e);return Pe(()=>void(t.current=e),[e]),t}function bo(){const e=eo(),t=to();return g.useMemo(()=>({children:n})=>{const r=!!no(e,!0,i=>i.type===g.StrictMode)?g.StrictMode:g.Fragment;return oe.jsx(r,{children:oe.jsx(t,{children:n})})},[e,t])}function yo({set:e}){return Pe(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}const ho=(e=>(e=class extends g.Component{constructor(...n){super(...n),this.state={error:!1}}componentDidCatch(n){this.props.set(n)}render(){return this.state.error?null:this.props.children}},e.getDerivedStateFromError=()=>({error:!0}),e))();function tn(e){var t;const n=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}function be(e){var t;return(t=e.__r3f)==null?void 0:t.root.getState()}const V={obj:e=>e===Object(e)&&!V.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,nul:e=>e===null,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:o="reference",strict:r=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(V.str(e)||V.num(e)||V.boo(e))return e===t;const i=V.obj(e);if(i&&o==="reference")return e===t;const c=V.arr(e);if(c&&n==="reference")return e===t;if((c||i)&&e===t)return!0;let a;for(a in e)if(!(a in t))return!1;if(i&&n==="shallow"&&o==="shallow"){for(a in r?t:e)if(!V.equ(e[a],t[a],{strict:r,objects:"reference"}))return!1}else for(a in r?t:e)if(e[a]!==t[a])return!1;if(V.und(a)){if(c&&e.length===0&&t.length===0||i&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Co(e){e.type!=="Scene"&&(e.dispose==null||e.dispose());for(const t in e){const n=e[t];n?.type!=="Scene"&&(n==null||n.dispose==null||n.dispose())}}const nn=["children","key","ref"];function Eo(e){const t={};for(const n in e)nn.includes(n)||(t[n]=e[n]);return t}function Ge(e,t,n,o){const r=e;let i=r?.__r3f;return i||(i={root:t,type:n,parent:null,children:[],props:Eo(o),object:r,eventCount:0,handlers:{},isHidden:!1},r&&(r.__r3f=i)),i}function je(e,t){let n=e[t];if(!t.includes("-"))return{root:e,key:t,target:n};n=e;for(const r of t.split("-")){var o;t=r,e=n,n=(o=n)==null?void 0:o[t]}return{root:e,key:t,target:n}}const Lt=/-\d+$/;function Xe(e,t){if(V.str(t.props.attach)){if(Lt.test(t.props.attach)){const r=t.props.attach.replace(Lt,""),{root:i,key:c}=je(e.object,r);Array.isArray(i[c])||(i[c]=[])}const{root:n,key:o}=je(e.object,t.props.attach);t.previousAttach=n[o],n[o]=t.object}else V.fun(t.props.attach)&&(t.previousAttach=t.props.attach(e.object,t.object))}function Qe(e,t){if(V.str(t.props.attach)){const{root:n,key:o}=je(e.object,t.props.attach),r=t.previousAttach;r===void 0?delete n[o]:n[o]=r}else t.previousAttach==null||t.previousAttach(e.object,t.object);delete t.previousAttach}const jt=[...nn,"args","dispose","attach","object","onUpdate","dispose"],Ht=new Map;function wo(e){let t=Ht.get(e.constructor);try{t||(t=new e.constructor,Ht.set(e.constructor,t))}catch{}return t}function jo(e,t){const n={};for(const o in t)if(!jt.includes(o)&&!V.equ(t[o],e.props[o])){n[o]=t[o];for(const r in t)r.startsWith(`${o}-`)&&(n[r]=t[r])}for(const o in e.props){if(jt.includes(o)||t.hasOwnProperty(o))continue;const{root:r,key:i}=je(e.object,o);if(r.constructor&&r.constructor.length===0){const c=wo(r);V.und(c)||(n[i]=c[i])}else n[i]=0}return n}const Po=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],So=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function de(e,t){var n;const o=e.__r3f,r=o&&Jt(o).getState(),i=o?.eventCount;for(const a in t){let s=t[a];if(jt.includes(a))continue;if(o&&So.test(a)){typeof s=="function"?o.handlers[a]=s:delete o.handlers[a],o.eventCount=Object.keys(o.handlers).length;continue}if(s===void 0)continue;let{root:u,key:l,target:d}=je(e,a);if(d instanceof kt&&s instanceof kt)d.mask=s.mask;else if(d instanceof Hn&&go(s))d.set(s);else if(d!==null&&typeof d=="object"&&typeof d.set=="function"&&typeof d.copy=="function"&&s!=null&&s.constructor&&d.constructor===s.constructor)d.copy(s);else if(d!==null&&typeof d=="object"&&typeof d.set=="function"&&Array.isArray(s))typeof d.fromArray=="function"?d.fromArray(s):d.set(...s);else if(d!==null&&typeof d=="object"&&typeof d.set=="function"&&typeof s=="number")typeof d.setScalar=="function"?d.setScalar(s):d.set(s);else{var c;u[l]=s,r&&!r.linear&&Po.includes(l)&&(c=u[l])!=null&&c.isTexture&&u[l].format===qn&&u[l].type===Wn&&(u[l].colorSpace=Zt)}}if(o!=null&&o.parent&&r!=null&&r.internal&&(n=o.object)!=null&&n.isObject3D&&i!==o.eventCount){const a=o.object,s=r.internal.interaction.indexOf(a);s>-1&&r.internal.interaction.splice(s,1),o.eventCount&&a.raycast!==null&&r.internal.interaction.push(a)}return o&&o.props.attach===void 0&&(o.object.isBufferGeometry?o.props.attach="geometry":o.object.isMaterial&&(o.props.attach="material")),o&&Ee(o),e}function Ee(e){var t;if(!e.parent)return;e.props.onUpdate==null||e.props.onUpdate(e.object);const n=(t=e.root)==null||t.getState==null?void 0:t.getState();n&&n.internal.frames===0&&n.invalidate()}function xo(e,t){e.manual||($t(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix())}const ne=e=>e?.isObject3D;function He(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function on(e,t,n,o){const r=n.get(t);r&&(n.delete(t),n.size===0&&(e.delete(o),r.target.releasePointerCapture(o)))}function Mo(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(o=>o!==t),n.initialHits=n.initialHits.filter(o=>o!==t),n.hovered.forEach((o,r)=>{(o.eventObject===t||o.object===t)&&n.hovered.delete(r)}),n.capturedMap.forEach((o,r)=>{on(n.capturedMap,t,o,r)})}function Ro(e){function t(s){const{internal:u}=e.getState(),l=s.offsetX-u.initialClick[0],d=s.offsetY-u.initialClick[1];return Math.round(Math.sqrt(l*l+d*d))}function n(s){return s.filter(u=>["Move","Over","Enter","Out","Leave"].some(l=>{var d;return(d=u.__r3f)==null?void 0:d.handlers["onPointer"+l]}))}function o(s,u){const l=e.getState(),d=new Set,p=[],b=u?u(l.internal.interaction):l.internal.interaction;for(let v=0;v<b.length;v++){const f=be(b[v]);f&&(f.raycaster.camera=void 0)}l.previousRoot||l.events.compute==null||l.events.compute(s,l);function M(v){const f=be(v);if(!f||!f.events.enabled||f.raycaster.camera===null)return[];if(f.raycaster.camera===void 0){var y;f.events.compute==null||f.events.compute(s,f,(y=f.previousRoot)==null?void 0:y.getState()),f.raycaster.camera===void 0&&(f.raycaster.camera=null)}return f.raycaster.camera?f.raycaster.intersectObject(v,!0):[]}let I=b.flatMap(M).sort((v,f)=>{const y=be(v.object),x=be(f.object);return!y||!x?v.distance-f.distance:x.events.priority-y.events.priority||v.distance-f.distance}).filter(v=>{const f=He(v);return d.has(f)?!1:(d.add(f),!0)});l.events.filter&&(I=l.events.filter(I,l));for(const v of I){let f=v.object;for(;f;){var C;(C=f.__r3f)!=null&&C.eventCount&&p.push({...v,eventObject:f}),f=f.parent}}if("pointerId"in s&&l.internal.capturedMap.has(s.pointerId))for(let v of l.internal.capturedMap.get(s.pointerId).values())d.has(He(v.intersection))||p.push(v.intersection);return p}function r(s,u,l,d){if(s.length){const p={stopped:!1};for(const b of s){let M=be(b.object);if(M||b.object.traverseAncestors(I=>{const C=be(I);if(C)return M=C,!1}),M){const{raycaster:I,pointer:C,camera:v,internal:f}=M,y=new ee(C.x,C.y,0).unproject(v),x=T=>{var _,D;return(_=(D=f.capturedMap.get(T))==null?void 0:D.has(b.eventObject))!=null?_:!1},h=T=>{const _={intersection:b,target:u.target};f.capturedMap.has(T)?f.capturedMap.get(T).set(b.eventObject,_):f.capturedMap.set(T,new Map([[b.eventObject,_]])),u.target.setPointerCapture(T)},P=T=>{const _=f.capturedMap.get(T);_&&on(f.capturedMap,b.eventObject,_,T)};let q={};for(let T in u){let _=u[T];typeof _!="function"&&(q[T]=_)}let W={...b,...q,pointer:C,intersections:s,stopped:p.stopped,delta:l,unprojectedPoint:y,ray:I.ray,camera:v,stopPropagation(){const T="pointerId"in u&&f.capturedMap.get(u.pointerId);if((!T||T.has(b.eventObject))&&(W.stopped=p.stopped=!0,f.hovered.size&&Array.from(f.hovered.values()).find(_=>_.eventObject===b.eventObject))){const _=s.slice(0,s.indexOf(b));i([..._,b])}},target:{hasPointerCapture:x,setPointerCapture:h,releasePointerCapture:P},currentTarget:{hasPointerCapture:x,setPointerCapture:h,releasePointerCapture:P},nativeEvent:u};if(d(W),p.stopped===!0)break}}}return s}function i(s){const{internal:u}=e.getState();for(const l of u.hovered.values())if(!s.length||!s.find(d=>d.object===l.object&&d.index===l.index&&d.instanceId===l.instanceId)){const p=l.eventObject.__r3f;if(u.hovered.delete(He(l)),p!=null&&p.eventCount){const b=p.handlers,M={...l,intersections:s};b.onPointerOut==null||b.onPointerOut(M),b.onPointerLeave==null||b.onPointerLeave(M)}}}function c(s,u){for(let l=0;l<u.length;l++){const d=u[l].__r3f;d==null||d.handlers.onPointerMissed==null||d.handlers.onPointerMissed(s)}}function a(s){switch(s){case"onPointerLeave":case"onPointerCancel":return()=>i([]);case"onLostPointerCapture":return u=>{const{internal:l}=e.getState();"pointerId"in u&&l.capturedMap.has(u.pointerId)&&requestAnimationFrame(()=>{l.capturedMap.has(u.pointerId)&&(l.capturedMap.delete(u.pointerId),i([]))})}}return function(l){const{onPointerMissed:d,internal:p}=e.getState();p.lastEvent.current=l;const b=s==="onPointerMove",M=s==="onClick"||s==="onContextMenu"||s==="onDoubleClick",C=o(l,b?n:void 0),v=M?t(l):0;s==="onPointerDown"&&(p.initialClick=[l.offsetX,l.offsetY],p.initialHits=C.map(y=>y.eventObject)),M&&!C.length&&v<=2&&(c(l,p.interaction),d&&d(l)),b&&i(C);function f(y){const x=y.eventObject,h=x.__r3f;if(!(h!=null&&h.eventCount))return;const P=h.handlers;if(b){if(P.onPointerOver||P.onPointerEnter||P.onPointerOut||P.onPointerLeave){const q=He(y),W=p.hovered.get(q);W?W.stopped&&y.stopPropagation():(p.hovered.set(q,y),P.onPointerOver==null||P.onPointerOver(y),P.onPointerEnter==null||P.onPointerEnter(y))}P.onPointerMove==null||P.onPointerMove(y)}else{const q=P[s];q?(!M||p.initialHits.includes(x))&&(c(l,p.interaction.filter(W=>!p.initialHits.includes(W))),q(y)):M&&p.initialHits.includes(x)&&c(l,p.interaction.filter(W=>!p.initialHits.includes(W)))}}r(C,l,v,f)}}return{handlePointer:a}}const qt=e=>!!(e!=null&&e.render),rn=g.createContext(null),Oo=(e,t)=>{const n=oo((a,s)=>{const u=new ee,l=new ee,d=new ee;function p(v=s().camera,f=l,y=s().size){const{width:x,height:h,top:P,left:q}=y,W=x/h;f.isVector3?d.copy(f):d.set(...f);const T=v.getWorldPosition(u).distanceTo(d);if($t(v))return{width:x/v.zoom,height:h/v.zoom,top:P,left:q,factor:1,distance:T,aspect:W};{const _=v.fov*Math.PI/180,D=2*Math.tan(_/2)*T,L=D*(x/h);return{width:L,height:D,top:P,left:q,factor:x/L,distance:T,aspect:W}}}let b;const M=v=>a(f=>({performance:{...f.performance,current:v}})),I=new Un;return{set:a,get:s,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(v=1)=>e(s(),v),advance:(v,f)=>t(v,f,s()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Vn,pointer:I,mouse:I,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const v=s();b&&clearTimeout(b),v.performance.current!==v.performance.min&&M(v.performance.min),b=setTimeout(()=>M(s().performance.max),v.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:p},setEvents:v=>a(f=>({...f,events:{...f.events,...v}})),setSize:(v,f,y=0,x=0)=>{const h=s().camera,P={width:v,height:f,top:y,left:x};a(q=>({size:P,viewport:{...q.viewport,...p(h,l,P)}}))},setDpr:v=>a(f=>{const y=tn(v);return{viewport:{...f.viewport,dpr:y,initialDpr:f.viewport.initialDpr||y}}}),setFrameloop:(v="always")=>{const f=s().clock;f.stop(),f.elapsedTime=0,v!=="never"&&(f.start(),f.elapsedTime=0),a(()=>({frameloop:v}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:g.createRef(),active:!1,frames:0,priority:0,subscribe:(v,f,y)=>{const x=s().internal;return x.priority=x.priority+(f>0?1:0),x.subscribers.push({ref:v,priority:f,store:y}),x.subscribers=x.subscribers.sort((h,P)=>h.priority-P.priority),()=>{const h=s().internal;h!=null&&h.subscribers&&(h.priority=h.priority-(f>0?1:0),h.subscribers=h.subscribers.filter(P=>P.ref!==v))}}}}}),o=n.getState();let r=o.size,i=o.viewport.dpr,c=o.camera;return n.subscribe(()=>{const{camera:a,size:s,viewport:u,gl:l,set:d}=n.getState();if(s.width!==r.width||s.height!==r.height||u.dpr!==i){r=s,i=u.dpr,xo(a,s),u.dpr>0&&l.setPixelRatio(u.dpr);const p=typeof HTMLCanvasElement<"u"&&l.domElement instanceof HTMLCanvasElement;l.setSize(s.width,s.height,p)}a!==c&&(c=a,d(p=>({viewport:{...p.viewport,...p.viewport.getCurrentViewport(a)}})))}),n.subscribe(a=>e(a)),n};function sn(){const e=g.useContext(rn);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function Io(e=n=>n,t){return sn()(e,t)}function an(e,t=0){const n=sn(),o=n.getState().internal.subscribe,r=en(e);return Pe(()=>o(r,t,n),[t,o,n]),null}function Fo(e){const t=Rn(e);return t.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:g.version}),t}const ln=0,Ce={},To=/^three(?=[A-Z])/,Ze=e=>`${e[0].toUpperCase()}${e.slice(1)}`;let Ao=0;const ko=e=>typeof e=="function";function Do(e){if(ko(e)){const t=`${Ao++}`;return Ce[t]=e,t}else Object.assign(Ce,e)}function cn(e,t){const n=Ze(e),o=Ce[n];if(e!=="primitive"&&!o)throw new Error(`R3F: ${n} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(e==="primitive"&&!t.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(t.args!==void 0&&!Array.isArray(t.args))throw new Error("R3F: The args prop must be an array!")}function Bo(e,t,n){var o;return e=Ze(e)in Ce?e:e.replace(To,""),cn(e,t),e==="primitive"&&(o=t.object)!=null&&o.__r3f&&delete t.object.__r3f,Ge(t.object,n,e,t)}function _o(e){if(!e.isHidden){var t;e.props.attach&&(t=e.parent)!=null&&t.object?Qe(e.parent,e):ne(e.object)&&(e.object.visible=!1),e.isHidden=!0,Ee(e)}}function un(e){if(e.isHidden){var t;e.props.attach&&(t=e.parent)!=null&&t.object?Xe(e.parent,e):ne(e.object)&&e.props.visible!==!1&&(e.object.visible=!0),e.isHidden=!1,Ee(e)}}function Ft(e,t,n){const o=t.root.getState();if(!(!e.parent&&e.object!==o.scene)){if(!t.object){var r,i;const c=Ce[Ze(t.type)];t.object=(r=t.props.object)!=null?r:new c(...(i=t.props.args)!=null?i:[]),t.object.__r3f=t}if(de(t.object,t.props),t.props.attach)Xe(e,t);else if(ne(t.object)&&ne(e.object)){const c=e.object.children.indexOf(n?.object);if(n&&c!==-1){const a=e.object.children.indexOf(t.object);if(a!==-1){e.object.children.splice(a,1);const s=a<c?c-1:c;e.object.children.splice(s,0,t.object)}else t.object.parent=e.object,e.object.children.splice(c,0,t.object),t.object.dispatchEvent({type:"added"}),e.object.dispatchEvent({type:"childadded",child:t.object})}else e.object.add(t.object)}for(const c of t.children)Ft(t,c);Ee(t)}}function gt(e,t){t&&(t.parent=e,e.children.push(t),Ft(e,t))}function Wt(e,t,n){if(!t||!n)return;t.parent=e;const o=e.children.indexOf(n);o!==-1?e.children.splice(o,0,t):e.children.push(t),Ft(e,t,n)}function dn(e){if(typeof e.dispose=="function"){const t=()=>{try{e.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?t():zt.unstable_scheduleCallback(zt.unstable_IdlePriority,t)}}function Pt(e,t,n){if(!t)return;t.parent=null;const o=e.children.indexOf(t);o!==-1&&e.children.splice(o,1),t.props.attach?Qe(e,t):ne(t.object)&&ne(e.object)&&(e.object.remove(t.object),Mo(Jt(t),t.object));const r=t.props.dispose!==null&&n!==!1;for(let i=t.children.length-1;i>=0;i--){const c=t.children[i];Pt(t,c,r)}t.children.length=0,delete t.object.__r3f,r&&t.type!=="primitive"&&t.object.type!=="Scene"&&dn(t.object),n===void 0&&Ee(t)}function No(e,t){for(const n of[e,e.alternate])if(n!==null)if(typeof n.ref=="function"){n.refCleanup==null||n.refCleanup();const o=n.ref(t);typeof o=="function"&&(n.refCleanup=o)}else n.ref&&(n.ref.current=t)}const Ve=[];function zo(){for(const[n]of Ve){const o=n.parent;if(o){n.props.attach?Qe(o,n):ne(n.object)&&ne(o.object)&&o.object.remove(n.object);for(const r of n.children)r.props.attach?Qe(n,r):ne(r.object)&&ne(n.object)&&n.object.remove(r.object)}n.isHidden&&un(n),n.object.__r3f&&delete n.object.__r3f,n.type!=="primitive"&&dn(n.object)}for(const[n,o,r]of Ve){n.props=o;const i=n.parent;if(i){var e,t;const c=Ce[Ze(n.type)];n.object=(e=n.props.object)!=null?e:new c(...(t=n.props.args)!=null?t:[]),n.object.__r3f=n,No(r,n.object),de(n.object,n.props),n.props.attach?Xe(i,n):ne(n.object)&&ne(i.object)&&i.object.add(n.object);for(const a of n.children)a.props.attach?Xe(n,a):ne(a.object)&&ne(n.object)&&n.object.add(a.object);Ee(n)}}Ve.length=0}const bt=()=>{},Ut={};let qe=ln;const Lo=0,Ho=4,St=Fo({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:Bo,removeChild:Pt,appendChild:gt,appendInitialChild:gt,insertBefore:Wt,appendChildToContainer(e,t){const n=e.getState().scene.__r3f;!t||!n||gt(n,t)},removeChildFromContainer(e,t){const n=e.getState().scene.__r3f;!t||!n||Pt(n,t)},insertInContainerBefore(e,t,n){const o=e.getState().scene.__r3f;!t||!n||!o||Wt(o,t,n)},getRootHostContext:()=>Ut,getChildHostContext:()=>Ut,commitUpdate(e,t,n,o,r){var i,c,a;cn(t,o);let s=!1;if((e.type==="primitive"&&n.object!==o.object||((i=o.args)==null?void 0:i.length)!==((c=n.args)==null?void 0:c.length)||(a=o.args)!=null&&a.some((l,d)=>{var p;return l!==((p=n.args)==null?void 0:p[d])}))&&(s=!0),s)Ve.push([e,{...o},r]);else{const l=jo(e,o);Object.keys(l).length&&(Object.assign(e.props,l),de(e.object,l))}(r.sibling===null||(r.flags&Ho)===Lo)&&zo()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:e=>e?.object,prepareForCommit:()=>null,preparePortalMount:e=>Ge(e.getState().scene,e,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:_o,unhideInstance:un,createTextInstance:bt,hideTextInstance:bt,unhideTextInstance:bt,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:g.createContext(null),setCurrentUpdatePriority(e){qe=e},getCurrentUpdatePriority(){return qe},resolveUpdatePriority(){var e;if(qe!==ln)return qe;switch(typeof window<"u"&&((e=window.event)==null?void 0:e.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Ue.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Ue.ContinuousEventPriority;default:return Ue.DefaultEventPriority}},resetFormInstance(){}}),ve=new Map,ye={objects:"shallow",strict:!1};function qo(e,t){if(!t&&typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:n,height:o,top:r,left:i}=e.parentElement.getBoundingClientRect();return{width:n,height:o,top:r,left:i}}else if(!t&&typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...t}}function Wo(e){const t=ve.get(e),n=t?.fiber,o=t?.store;t&&console.warn("R3F.createRoot should only be called once!");const r=typeof reportError=="function"?reportError:console.error,i=o||Oo(Rt,Gt),c=n||St.createContainer(i,Ue.ConcurrentRoot,null,!1,null,"",r,r,r,null);t||ve.set(e,{fiber:c,store:i});let a,s,u=!1,l=null;return{async configure(d={}){let p;l=new Promise(S=>p=S);let{gl:b,size:M,scene:I,events:C,onCreated:v,shadows:f=!1,linear:y=!1,flat:x=!1,legacy:h=!1,orthographic:P=!1,frameloop:q="always",dpr:W=[1,2],performance:T,raycaster:_,camera:D,onPointerMissed:L}=d,O=i.getState(),H=O.gl;if(!O.gl){const S={canvas:e,powerPreference:"high-performance",antialias:!0,alpha:!0},A=typeof b=="function"?await b(S):b;qt(A)?H=A:H=new In({...S,...b}),O.set({gl:H})}let G=O.raycaster;G||O.set({raycaster:G=new Fn});const{params:m,...E}=_||{};if(V.equ(E,G,ye)||de(G,{...E}),V.equ(m,G.params,ye)||de(G,{params:{...G.params,...m}}),!O.camera||O.camera===s&&!V.equ(s,D,ye)){s=D;const S=D?.isCamera,A=S?D:P?new Tn(0,0,0,0,.1,1e3):new An(75,0,.1,1e3);S||(A.position.z=5,D&&(de(A,D),A.manual||("aspect"in D||"left"in D||"right"in D||"bottom"in D||"top"in D)&&(A.manual=!0,A.updateProjectionMatrix())),!O.camera&&!(D!=null&&D.rotation)&&A.lookAt(0,0,0)),O.set({camera:A}),G.camera=A}if(!O.scene){let S;I!=null&&I.isScene?(S=I,Ge(S,i,"",{})):(S=new kn,Ge(S,i,"",{}),I&&de(S,I)),O.set({scene:S})}C&&!O.events.handlers&&O.set({events:C(i)});const j=qo(e,M);if(V.equ(j,O.size,ye)||O.setSize(j.width,j.height,j.top,j.left),W&&O.viewport.dpr!==tn(W)&&O.setDpr(W),O.frameloop!==q&&O.setFrameloop(q),O.onPointerMissed||O.set({onPointerMissed:L}),T&&!V.equ(T,O.performance,ye)&&O.set(S=>({performance:{...S.performance,...T}})),!O.xr){var B;const S=(z,Q)=>{const w=i.getState();w.frameloop!=="never"&&Gt(z,!0,w,Q)},A=()=>{const z=i.getState();z.gl.xr.enabled=z.gl.xr.isPresenting,z.gl.xr.setAnimationLoop(z.gl.xr.isPresenting?S:null),z.gl.xr.isPresenting||Rt(z)},X={connect(){const z=i.getState().gl;z.xr.addEventListener("sessionstart",A),z.xr.addEventListener("sessionend",A)},disconnect(){const z=i.getState().gl;z.xr.removeEventListener("sessionstart",A),z.xr.removeEventListener("sessionend",A)}};typeof((B=H.xr)==null?void 0:B.addEventListener)=="function"&&X.connect(),O.set({xr:X})}if(H.shadowMap){const S=H.shadowMap.enabled,A=H.shadowMap.type;if(H.shadowMap.enabled=!!f,V.boo(f))H.shadowMap.type=ft;else if(V.str(f)){var k;const X={basic:_n,percentage:Bn,soft:ft,variance:Dn};H.shadowMap.type=(k=X[f])!=null?k:ft}else V.obj(f)&&Object.assign(H.shadowMap,f);(S!==H.shadowMap.enabled||A!==H.shadowMap.type)&&(H.shadowMap.needsUpdate=!0)}return Gn.enabled=!h,u||(H.outputColorSpace=y?Nn:Zt,H.toneMapping=x?zn:Ln),O.legacy!==h&&O.set(()=>({legacy:h})),O.linear!==y&&O.set(()=>({linear:y})),O.flat!==x&&O.set(()=>({flat:x})),b&&!V.fun(b)&&!qt(b)&&!V.equ(b,H,ye)&&de(H,b),a=v,u=!0,p(),this},render(d){return!u&&!l&&this.configure(),l.then(()=>{St.updateContainer(oe.jsx(Uo,{store:i,children:d,onCreated:a,rootElement:e}),c,null,()=>{})}),i},unmount(){fn(e)}}}function Uo({store:e,children:t,onCreated:n,rootElement:o}){return Pe(()=>{const r=e.getState();r.set(i=>({internal:{...i.internal,active:!0}})),n&&n(r),e.getState().events.connected||r.events.connect==null||r.events.connect(o)},[]),oe.jsx(rn.Provider,{value:e,children:t})}function fn(e,t){const n=ve.get(e),o=n?.fiber;if(o){const r=n?.store.getState();r&&(r.internal.active=!1),St.updateContainer(null,o,null,()=>{r&&setTimeout(()=>{try{var i,c,a,s;r.events.disconnect==null||r.events.disconnect(),(i=r.gl)==null||(c=i.renderLists)==null||c.dispose==null||c.dispose(),(a=r.gl)==null||a.forceContextLoss==null||a.forceContextLoss(),(s=r.gl)!=null&&s.xr&&r.xr.disconnect(),Co(r.scene),ve.delete(e)}catch{}},500)})}}const Vo=new Set,Go=new Set,Xo=new Set;function yt(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function we(e,t){switch(e){case"before":return yt(Vo,t);case"after":return yt(Go,t);case"tail":return yt(Xo,t)}}let ht,Ct;function xt(e,t,n){let o=t.clock.getDelta();t.frameloop==="never"&&typeof e=="number"&&(o=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),ht=t.internal.subscribers;for(let r=0;r<ht.length;r++)Ct=ht[r],Ct.ref.current(Ct.store.getState(),o,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}let Ye=!1,Mt=!1,Et,Vt,he;function pn(e){Vt=requestAnimationFrame(pn),Ye=!0,Et=0,we("before",e),Mt=!0;for(const n of ve.values()){var t;he=n.store.getState(),he.internal.active&&(he.frameloop==="always"||he.internal.frames>0)&&!((t=he.gl.xr)!=null&&t.isPresenting)&&(Et+=xt(e,he))}if(Mt=!1,we("after",e),Et===0)return we("tail",e),Ye=!1,cancelAnimationFrame(Vt)}function Rt(e,t=1){var n;if(!e)return ve.forEach(o=>Rt(o.store.getState(),t));(n=e.gl.xr)!=null&&n.isPresenting||!e.internal.active||e.frameloop==="never"||(t>1?e.internal.frames=Math.min(60,e.internal.frames+t):Mt?e.internal.frames=2:e.internal.frames=1,Ye||(Ye=!0,requestAnimationFrame(pn)))}function Gt(e,t=!0,n,o){if(t&&we("before",e),n)xt(e,n,o);else for(const r of ve.values())xt(e,r.store.getState());t&&we("after",e)}const wt={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Qo(e){const{handlePointer:t}=Ro(e);return{priority:1,enabled:!0,compute(n,o,r){o.pointer.set(n.offsetX/o.size.width*2-1,-(n.offsetY/o.size.height)*2+1),o.raycaster.setFromCamera(o.pointer,o.camera)},connected:void 0,handlers:Object.keys(wt).reduce((n,o)=>({...n,[o]:t(o)}),{}),update:()=>{var n;const{events:o,internal:r}=e.getState();(n=r.lastEvent)!=null&&n.current&&o.handlers&&o.handlers.onPointerMove(r.lastEvent.current)},connect:n=>{const{set:o,events:r}=e.getState();if(r.disconnect==null||r.disconnect(),o(i=>({events:{...i.events,connected:n}})),r.handlers)for(const i in r.handlers){const c=r.handlers[i],[a,s]=wt[i];n.addEventListener(a,c,{passive:s})}},disconnect:()=>{const{set:n,events:o}=e.getState();if(o.connected){if(o.handlers)for(const r in o.handlers){const i=o.handlers[r],[c]=wt[r];o.connected.removeEventListener(c,i)}n(r=>({events:{...r.events,connected:void 0}}))}}}}function Yo({ref:e,children:t,fallback:n,resize:o,style:r,gl:i,events:c=Qo,eventSource:a,eventPrefix:s,shadows:u,linear:l,flat:d,legacy:p,orthographic:b,frameloop:M,dpr:I,performance:C,raycaster:v,camera:f,scene:y,onPointerMissed:x,onCreated:h,...P}){g.useMemo(()=>Do(Xn),[]);const q=bo(),[W,T]=On({scroll:!0,debounce:{scroll:50,resize:0},...o}),_=g.useRef(null),D=g.useRef(null);g.useImperativeHandle(e,()=>_.current);const L=en(x),[O,H]=g.useState(!1),[G,m]=g.useState(!1);if(O)throw O;if(G)throw G;const E=g.useRef(null);Pe(()=>{const B=_.current;if(T.width>0&&T.height>0&&B){E.current||(E.current=Wo(B));async function k(){await E.current.configure({gl:i,scene:y,events:c,shadows:u,linear:l,flat:d,legacy:p,orthographic:b,frameloop:M,dpr:I,performance:C,raycaster:v,camera:f,size:T,onPointerMissed:(...S)=>L.current==null?void 0:L.current(...S),onCreated:S=>{S.events.connect==null||S.events.connect(a?mo(a)?a.current:a:D.current),s&&S.setEvents({compute:(A,X)=>{const z=A[s+"X"],Q=A[s+"Y"];X.pointer.set(z/X.size.width*2-1,-(Q/X.size.height)*2+1),X.raycaster.setFromCamera(X.pointer,X.camera)}}),h?.(S)}}),E.current.render(oe.jsx(q,{children:oe.jsx(ho,{set:m,children:oe.jsx(g.Suspense,{fallback:oe.jsx(yo,{set:H}),children:t??null})})}))}k()}}),g.useEffect(()=>{const B=_.current;if(B)return()=>fn(B)},[]);const j=a?"none":"auto";return oe.jsx("div",{ref:D,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:j,...r},...P,children:oe.jsx("div",{ref:W,style:{width:"100%",height:"100%"},children:oe.jsx("canvas",{ref:_,style:{display:"block"},children:n})})})}function ti(e){return oe.jsx(ro,{children:oe.jsx(Yo,{...e})})}function Ko(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Zo(e){var t=Ko(e,"string");return typeof t=="symbol"?t:t+""}function Jo(e,t,n){return(t=Zo(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,o)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Xt(Object(n),!0).forEach(function(o){Jo(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xt(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}const $o=new Ot;new It;const er=new ee;new Jn;const fe=new Yn,Z=new ee,ce=new Ot,me=new ee,tr=e=>{const[t,n,o]=e;return new ee(t,n,o)},Qt=({x:e,y:t,z:n,w:o})=>$o.set(e,t,n,o),nr=e=>{if(Array.isArray(e))return new pt(e[0],e[1],e[2]);if(typeof e=="number")return new pt(e,e,e);{const t=e;return new pt(t.x,t.y,t.z)}},or={fixed:1,dynamic:0,kinematicPosition:2,kinematicVelocity:3},vn=e=>or[e],rr=(e,t)=>{const n=Array.from(e);for(let o=0;o<e.length/3;o++)n[o*3]*=t.x,n[o*3+1]*=t.y,n[o*3+2]*=t.z;return n},mn=e=>e?e instanceof Ot?[e.x,e.y,e.z,e.w]:e instanceof ee||e instanceof It?[e.x,e.y,e.z]:Array.isArray(e)?e:[e]:[0];function ue(e){const t=g.useRef(void 0);return t.current===void 0&&(t.current={value:typeof e=="function"?e():e}),t.current.value}const ir=e=>{const t=g.useRef(e),n=g.useRef(0),o=g.useRef(0);g.useEffect(()=>{t.current=e},[e]),g.useEffect(()=>{const r=()=>{const i=performance.now(),c=i-o.current;n.current=requestAnimationFrame(r),t.current(c/1e3),o.current=i};return n.current=requestAnimationFrame(r),()=>cancelAnimationFrame(n.current)},[])},sr=({onStep:e,updatePriority:t})=>(an((n,o)=>{e(o)},t),null),ar=({onStep:e})=>(ir(t=>{e(t)}),null),lr=({onStep:e,type:t,updatePriority:n})=>t==="independent"?R.createElement(ar,{onStep:e}):R.createElement(sr,{onStep:e,updatePriority:n});var cr=g.memo(lr);function ur(e,t){if(e==null)return{};var n={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(t.indexOf(o)!==-1)continue;n[o]=e[o]}return n}function Ke(e,t){if(e==null)return{};var n,o,r=ur(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const dr=["mass","linearDamping","angularDamping","type","onCollisionEnter","onCollisionExit","onIntersectionEnter","onIntersectionExit","onContactForce","children","canSleep","ccd","gravityScale","softCcdPrediction","ref"],fr=(e,t,n)=>{const o=t.slice();if(e==="heightfield"){const i=o[3];return i.x*=n.x,i.x*=n.y,i.x*=n.z,o}if(e==="trimesh"||e==="convexHull")return o[0]=rr(o[0],n),o;const r=[n.x,n.y,n.z,n.x,n.x];return o.map((i,c)=>r[c]*i)},pr=(e,t,n,o)=>{const r=fr(e.shape,e.args,n),i=lo[e.shape](...r);return t.createCollider(i,o?.())},vr=["shape","args"],Yt="Please pick ONLY ONE of the `density`, `mass` and `massProperties` options.",mr=(e,t)=>{if(t.density!==void 0){if(t.mass!==void 0||t.massProperties!==void 0)throw new Error(Yt);e.setDensity(t.density);return}if(t.mass!==void 0){if(t.massProperties!==void 0)throw new Error(Yt);e.setMass(t.mass);return}t.massProperties!==void 0&&e.setMassProperties(t.massProperties.mass,t.massProperties.centerOfMass,t.massProperties.principalAngularInertia,t.massProperties.angularInertiaLocalFrame)},gn={sensor:(e,t)=>{e.setSensor(t)},collisionGroups:(e,t)=>{e.setCollisionGroups(t)},solverGroups:(e,t)=>{e.setSolverGroups(t)},friction:(e,t)=>{e.setFriction(t)},frictionCombineRule:(e,t)=>{e.setFrictionCombineRule(t)},restitution:(e,t)=>{e.setRestitution(t)},restitutionCombineRule:(e,t)=>{e.setRestitutionCombineRule(t)},activeCollisionTypes:(e,t)=>{e.setActiveCollisionTypes(t)},contactSkin:(e,t)=>{e.setContactSkin(t)},quaternion:()=>{},position:()=>{},rotation:()=>{},scale:()=>{}},bn=Object.keys(gn),gr=(e,t,n)=>{const o=n.get(e.handle);if(o){var r;const i=o.object.parent.getWorldScale(er),c=(r=o.worldParent)===null||r===void 0?void 0:r.matrixWorld.clone().invert();o.object.updateWorldMatrix(!0,!1),fe.copy(o.object.matrixWorld),c&&fe.premultiply(c),fe.decompose(Z,ce,me),e.parent()?(e.setTranslationWrtParent({x:Z.x*i.x,y:Z.y*i.y,z:Z.z*i.z}),e.setRotationWrtParent(ce)):(e.setTranslation({x:Z.x*i.x,y:Z.y*i.y,z:Z.z*i.z}),e.setRotation(ce)),bn.forEach(a=>{if(a in t){const s=t[a];gn[a](e,s,t)}}),mr(e,t)}},br=(e,t,n)=>{const o=g.useMemo(()=>bn.flatMap(r=>mn(t[r])),[t]);g.useEffect(()=>{const r=e();gr(r,t,n)},[...o,e])},yr=e=>{let t=!1;return e.traverseAncestors(n=>{n.userData.r3RapierType==="MeshCollider"&&(t=!0)}),t},hr=(e,t,n)=>({collider:e,worldParent:n||void 0,object:t}),Cr={cuboid:"cuboid",ball:"ball",hull:"convexHull",trimesh:"trimesh"},Er=({object:e,ignoreMeshColliders:t=!0,options:n})=>{const o=[];e.updateWorldMatrix(!0,!1);const r=e.matrixWorld.clone().invert(),i=c=>{if("isMesh"in c){if(t&&yr(c))return;const a=c.getWorldScale(me),s=Cr[n.colliders||"cuboid"];c.updateWorldMatrix(!0,!1),fe.copy(c.matrixWorld).premultiply(r).decompose(Z,ce,me);const u=new It().setFromQuaternion(ce,"XYZ"),{geometry:l}=c,{args:d,offset:p}=wr(l,n.colliders||"cuboid"),b=N(N({},hn(n)),{},{args:d,shape:s,rotation:[u.x,u.y,u.z],position:[Z.x+p.x*a.x,Z.y+p.y*a.y,Z.z+p.z*a.z],scale:[a.x,a.y,a.z]});o.push(b)}};return n.includeInvisible?e.traverse(i):e.traverseVisible(i),o},wr=(e,t)=>{switch(t){case"cuboid":{e.computeBoundingBox();const{boundingBox:o}=e,r=o.getSize(new ee);return{args:[r.x/2,r.y/2,r.z/2],offset:o.getCenter(new ee)}}case"ball":{e.computeBoundingSphere();const{boundingSphere:o}=e;return{args:[o.radius],offset:o.center}}case"trimesh":{var n;const o=e.index?e.clone():Zn(e);return{args:[o.attributes.position.array,(n=o.index)===null||n===void 0?void 0:n.array],offset:new ee}}case"hull":return{args:[e.clone().attributes.position.array],offset:new ee}}return{args:[],offset:new ee}},yn=e=>({collision:!!(e!=null&&e.onCollisionEnter||e!=null&&e.onCollisionExit||e!=null&&e.onIntersectionEnter||e!=null&&e.onIntersectionExit),contactForce:!!(e!=null&&e.onContactForce)}),jr=(e,t,n,o={})=>{const{onCollisionEnter:r,onCollisionExit:i,onIntersectionEnter:c,onIntersectionExit:a,onContactForce:s}=t;g.useEffect(()=>{const u=e();if(u){const{collision:l,contactForce:d}=yn(t),p=l||o.collision,b=d||o.contactForce;p&&b?u.setActiveEvents(Le.COLLISION_EVENTS|Le.CONTACT_FORCE_EVENTS):p?u.setActiveEvents(Le.COLLISION_EVENTS):b&&u.setActiveEvents(Le.CONTACT_FORCE_EVENTS),n.set(u.handle,{onCollisionEnter:r,onCollisionExit:i,onIntersectionEnter:c,onIntersectionExit:a,onContactForce:s})}return()=>{u&&n.delete(u.handle)}},[r,i,c,a,s,o])},hn=(e={})=>Ke(e,dr),Je=()=>{const e=g.useContext(Cn);if(!e)throw new Error("react-three-rapier: useRapier must be used within <Physics />!");return e},Tt=(e,t,n=!0)=>{const[o,r]=g.useState([]);return g.useEffect(()=>{e.current&&t.colliders!==!1&&r(Er({object:e.current,options:t,ignoreMeshColliders:n}))},[t.colliders]),o},Pr=g.memo(()=>{const{world:e}=Je(),t=g.useRef(null);return an(()=>{const n=t.current;if(!n)return;const o=e.debugRender(),r=new Kn;r.setAttribute("position",new Dt(o.vertices,3)),r.setAttribute("color",new Dt(o.colors,4)),n.geometry.dispose(),n.geometry=r}),R.createElement("group",null,R.createElement("lineSegments",{ref:t,frustumCulled:!1},R.createElement("lineBasicMaterial",{color:16777215,vertexColors:!0}),R.createElement("bufferGeometry",null)))}),Sr=e=>{let t;const n={get(c,a){return t||(t=e()),Reflect.get(t,a)},set(c,a,s){return t||(t=e()),Reflect.set(t,a,s)}};return{proxy:new Proxy({},n),reset:()=>{t=void 0},set:c=>{t=c}}},Cn=g.createContext(void 0),We=(e,t)=>{var n,o,r,i,c,a;return{target:{rigidBody:e.rigidBody.object,collider:e.collider.object,colliderObject:(n=e.collider.state)===null||n===void 0?void 0:n.object,rigidBodyObject:(o=e.rigidBody.state)===null||o===void 0?void 0:o.object},other:{rigidBody:t.rigidBody.object,collider:t.collider.object,colliderObject:(r=t.collider.state)===null||r===void 0?void 0:r.object,rigidBodyObject:(i=t.rigidBody.state)===null||i===void 0?void 0:i.object},rigidBody:t.rigidBody.object,collider:t.collider.object,colliderObject:(c=t.collider.state)===null||c===void 0?void 0:c.object,rigidBodyObject:(a=t.rigidBody.state)===null||a===void 0?void 0:a.object}},Kt=async()=>{let e=await fo(()=>import("./rapier-BodjHcp2.js"),[]);return await e.init(),e},ni=e=>{const{colliders:t="cuboid",children:n,timeStep:o=1/60,paused:r=!1,interpolate:i=!0,updatePriority:c,updateLoop:a="follow",debug:s=!1,gravity:u=[0,-9.81,0],allowedLinearError:l=.001,predictionDistance:d=.002,numSolverIterations:p=4,numAdditionalFrictionIterations:b=4,numInternalPgsIterations:M=1,minIslandSize:I=128,maxCcdSubsteps:C=1,contactNaturalFrequency:v=30,lengthUnit:f=1}=e,y=io(Kt,["@react-thee/rapier",Kt]),{invalidate:x}=Io(),h=ue(()=>new Map),P=ue(()=>new Map),q=ue(()=>new Map),W=ue(()=>new Map),T=ue(()=>new so(!1)),_=ue(()=>new Set),D=ue(()=>new Set),{proxy:L,reset:O,set:H}=ue(()=>Sr(()=>new y.World(tr(u))));g.useEffect(()=>()=>{L.free(),O()},[]),g.useEffect(()=>{L.gravity=nr(u),L.integrationParameters.numSolverIterations=p,L.integrationParameters.numAdditionalFrictionIterations=b,L.integrationParameters.numInternalPgsIterations=M,L.integrationParameters.normalizedAllowedLinearError=l,L.integrationParameters.minIslandSize=I,L.integrationParameters.maxCcdSubsteps=C,L.integrationParameters.normalizedPredictionDistance=d,L.lengthUnit=f,L.integrationParameters.contact_natural_frequency=v},[L,...u,p,b,M,l,I,C,d,f,v]);const G=g.useCallback(k=>{var S;const A=L.getCollider(k),X=W.get(k),z=P.get(k),Q=A==null||(S=A.parent())===null||S===void 0?void 0:S.handle,w=Q!==void 0?L.getRigidBody(Q):void 0,J=w&&Q!==void 0?q.get(Q):void 0,$=Q!==void 0?h.get(Q):void 0;return{collider:{object:A,events:X,state:z},rigidBody:{object:w,events:J,state:$}}},[]),[m]=g.useState({previousState:{},accumulator:0}),E=g.useCallback(k=>{const S=L,A=o==="vary",X=Qn.clamp(k,0,.5),z=w=>{_.forEach(J=>{J.current(S)}),S.timestep=w,S.step(T),D.forEach(J=>{J.current(S)})};if(A)z(X);else for(m.accumulator+=X;m.accumulator>=o;)i&&(m.previousState={},S.forEachRigidBody(w=>{m.previousState[w.handle]={position:w.translation(),rotation:w.rotation()}})),z(o),m.accumulator-=o;const Q=A||!i||r?1:m.accumulator/o;h.forEach((w,J)=>{const $=S.getRigidBody(J),F=q.get(J);if(F!=null&&F.onSleep||F!=null&&F.onWake){if($.isSleeping()&&!w.isSleeping){var U;F==null||(U=F.onSleep)===null||U===void 0||U.call(F)}if(!$.isSleeping()&&w.isSleeping){var K;F==null||(K=F.onWake)===null||K===void 0||K.call(F)}w.isSleeping=$.isSleeping()}if(!$||$.isSleeping()&&!("isInstancedMesh"in w.object)||!w.setMatrix)return;let te=$.translation(),se=$.rotation(),ae=m.previousState[J];ae&&(fe.compose(ae.position,Qt(ae.rotation),w.scale).premultiply(w.invertedWorldMatrix).decompose(Z,ce,me),w.meshType=="mesh"&&(w.object.position.copy(Z),w.object.quaternion.copy(ce))),fe.compose(te,Qt(se),w.scale).premultiply(w.invertedWorldMatrix).decompose(Z,ce,me),w.meshType=="instancedMesh"?w.setMatrix(fe):(w.object.position.lerp(Z,Q),w.object.quaternion.slerp(ce,Q))}),T.drainCollisionEvents((w,J,$)=>{const F=G(w),U=G(J);if(!(F!=null&&F.collider.object)||!(U!=null&&U.collider.object))return;const K=We(F,U),te=We(U,F);if($)S.contactPair(F.collider.object,U.collider.object,(ke,De)=>{var Be,lt,_e,ct,Ne,ut,ze,dt;(Be=F.rigidBody.events)===null||Be===void 0||(lt=Be.onCollisionEnter)===null||lt===void 0||lt.call(Be,N(N({},K),{},{manifold:ke,flipped:De})),(_e=U.rigidBody.events)===null||_e===void 0||(ct=_e.onCollisionEnter)===null||ct===void 0||ct.call(_e,N(N({},te),{},{manifold:ke,flipped:De})),(Ne=F.collider.events)===null||Ne===void 0||(ut=Ne.onCollisionEnter)===null||ut===void 0||ut.call(Ne,N(N({},K),{},{manifold:ke,flipped:De})),(ze=U.collider.events)===null||ze===void 0||(dt=ze.onCollisionEnter)===null||dt===void 0||dt.call(ze,N(N({},te),{},{manifold:ke,flipped:De}))});else{var se,ae,ie,le,pe,ge,Se,$e;(se=F.rigidBody.events)===null||se===void 0||(ae=se.onCollisionExit)===null||ae===void 0||ae.call(se,K),(ie=U.rigidBody.events)===null||ie===void 0||(le=ie.onCollisionExit)===null||le===void 0||le.call(ie,te),(pe=F.collider.events)===null||pe===void 0||(ge=pe.onCollisionExit)===null||ge===void 0||ge.call(pe,K),(Se=U.collider.events)===null||Se===void 0||($e=Se.onCollisionExit)===null||$e===void 0||$e.call(Se,te)}if($){if(S.intersectionPair(F.collider.object,U.collider.object)){var xe,et,Me,tt,Re,nt,Oe,ot;(xe=F.rigidBody.events)===null||xe===void 0||(et=xe.onIntersectionEnter)===null||et===void 0||et.call(xe,K),(Me=U.rigidBody.events)===null||Me===void 0||(tt=Me.onIntersectionEnter)===null||tt===void 0||tt.call(Me,te),(Re=F.collider.events)===null||Re===void 0||(nt=Re.onIntersectionEnter)===null||nt===void 0||nt.call(Re,K),(Oe=U.collider.events)===null||Oe===void 0||(ot=Oe.onIntersectionEnter)===null||ot===void 0||ot.call(Oe,te)}}else{var Ie,rt,Fe,it,Te,st,Ae,at;(Ie=F.rigidBody.events)===null||Ie===void 0||(rt=Ie.onIntersectionExit)===null||rt===void 0||rt.call(Ie,K),(Fe=U.rigidBody.events)===null||Fe===void 0||(it=Fe.onIntersectionExit)===null||it===void 0||it.call(Fe,te),(Te=F.collider.events)===null||Te===void 0||(st=Te.onIntersectionExit)===null||st===void 0||st.call(Te,K),(Ae=U.collider.events)===null||Ae===void 0||(at=Ae.onIntersectionExit)===null||at===void 0||at.call(Ae,te)}}),T.drainContactForceEvents(w=>{var J,$,F,U,K,te,se,ae;const ie=G(w.collider1()),le=G(w.collider2());if(!(ie!=null&&ie.collider.object)||!(le!=null&&le.collider.object))return;const pe=We(ie,le),ge=We(le,ie);(J=ie.rigidBody.events)===null||J===void 0||($=J.onContactForce)===null||$===void 0||$.call(J,N(N({},pe),{},{totalForce:w.totalForce(),totalForceMagnitude:w.totalForceMagnitude(),maxForceDirection:w.maxForceDirection(),maxForceMagnitude:w.maxForceMagnitude()})),(F=le.rigidBody.events)===null||F===void 0||(U=F.onContactForce)===null||U===void 0||U.call(F,N(N({},ge),{},{totalForce:w.totalForce(),totalForceMagnitude:w.totalForceMagnitude(),maxForceDirection:w.maxForceDirection(),maxForceMagnitude:w.maxForceMagnitude()})),(K=ie.collider.events)===null||K===void 0||(te=K.onContactForce)===null||te===void 0||te.call(K,N(N({},pe),{},{totalForce:w.totalForce(),totalForceMagnitude:w.totalForceMagnitude(),maxForceDirection:w.maxForceDirection(),maxForceMagnitude:w.maxForceMagnitude()})),(se=le.collider.events)===null||se===void 0||(ae=se.onContactForce)===null||ae===void 0||ae.call(se,N(N({},ge),{},{totalForce:w.totalForce(),totalForceMagnitude:w.totalForceMagnitude(),maxForceDirection:w.maxForceDirection(),maxForceMagnitude:w.maxForceMagnitude()}))}),S.forEachActiveRigidBody(()=>{x()})},[r,o,i,L]),j=g.useMemo(()=>({rapier:y,world:L,setWorld:k=>{H(k)},physicsOptions:{colliders:t,gravity:u},rigidBodyStates:h,colliderStates:P,rigidBodyEvents:q,colliderEvents:W,beforeStepCallbacks:_,afterStepCallbacks:D,isPaused:r,isDebug:s,step:E}),[r,E,s,t,u]),B=g.useCallback(k=>{r||E(k)},[r,E]);return R.createElement(Cn.Provider,{value:j},R.createElement(cr,{onStep:B,type:a,updatePriority:c}),s&&R.createElement(Pr,null),n)};function Y(){return Y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Y.apply(null,arguments)}const At=(e,t=null)=>{const n=g.useRef(t);return e&&typeof e!="function"?(e.current||(e.current=n.current),e):n},En=(e,t,n)=>{const o=g.useRef(void 0),r=g.useCallback(()=>(o.current||(o.current=e()),o.current),n);return g.useEffect(()=>{const i=r(),c=()=>t(i);return()=>{c(),o.current=void 0}},[r]),r},xr=e=>{var t;const n=vn(e?.type||"dynamic"),o=new ao(n);return o.canSleep=(t=e?.canSleep)!==null&&t!==void 0?t:!0,o},Mr=({rigidBody:e,object:t,setMatrix:n,getMatrix:o,worldScale:r,meshType:i="mesh"})=>{t.updateWorldMatrix(!0,!1);const c=t.parent.matrixWorld.clone().invert();return{object:t,rigidBody:e,invertedWorldMatrix:c,setMatrix:n||(a=>{t.matrix.copy(a)}),getMatrix:o||(a=>a.copy(t.matrix)),scale:r||t.getWorldScale(me).clone(),isSleeping:!1,meshType:i}},Rr=["args","colliders","canSleep"],wn={gravityScale:(e,t)=>{e.setGravityScale(t,!0)},additionalSolverIterations(e,t){e.setAdditionalSolverIterations(t)},linearDamping:(e,t)=>{e.setLinearDamping(t)},angularDamping:(e,t)=>{e.setAngularDamping(t)},dominanceGroup:(e,t)=>{e.setDominanceGroup(t)},enabledRotations:(e,[t,n,o])=>{e.setEnabledRotations(t,n,o,!0)},enabledTranslations:(e,[t,n,o])=>{e.setEnabledTranslations(t,n,o,!0)},lockRotations:(e,t)=>{e.lockRotations(t,!0)},lockTranslations:(e,t)=>{e.lockTranslations(t,!0)},angularVelocity:(e,[t,n,o])=>{e.setAngvel({x:t,y:n,z:o},!0)},linearVelocity:(e,[t,n,o])=>{e.setLinvel({x:t,y:n,z:o},!0)},ccd:(e,t)=>{e.enableCcd(t)},softCcdPrediction:(e,t)=>{e.setSoftCcdPrediction(t)},userData:(e,t)=>{e.userData=t},type(e,t){e.setBodyType(vn(t),!0)},position:()=>{},rotation:()=>{},quaternion:()=>{},scale:()=>{}},jn=Object.keys(wn),Or=(e,t,n,o=!0)=>{if(!e)return;const r=n.get(e.handle);r&&(o&&(r.object.updateWorldMatrix(!0,!1),fe.copy(r.object.matrixWorld).decompose(Z,ce,me),e.setTranslation(Z,!1),e.setRotation(ce,!1)),jn.forEach(i=>{i in t&&wn[i](e,t[i])}))},Ir=(e,t,n,o=!0)=>{const r=g.useMemo(()=>jn.flatMap(i=>mn(t[i])),[t]);g.useEffect(()=>{const i=e();Or(i,t,n,o)},r)},Fr=(e,t,n)=>{const{onWake:o,onSleep:r,onCollisionEnter:i,onCollisionExit:c,onIntersectionEnter:a,onIntersectionExit:s,onContactForce:u}=t,l={onWake:o,onSleep:r,onCollisionEnter:i,onCollisionExit:c,onIntersectionEnter:a,onIntersectionExit:s,onContactForce:u};g.useEffect(()=>{const d=e();return n.set(d.handle,l),()=>{n.delete(d.handle)}},[o,r,i,c,a,s,u])},Tr=({x:e,y:t,z:n}={x:0,y:0,z:0})=>new ee(e,t,n),re=g.memo(e=>{const{children:t,position:n,rotation:o,quaternion:r,scale:i,name:c}=e,{world:a,colliderEvents:s,colliderStates:u}=Je(),l=xn(),d=At(e.ref),p=g.useRef(null),b=vr.flatMap(C=>Array.isArray(e[C])?e[C]:[e[C]]),M=En(()=>{const C=p.current.getWorldScale(Tr()),v=pr(e,a,C,l?.getRigidBody);return typeof e.ref=="function"&&e.ref(v),d.current=v,v},C=>{a.getCollider(C.handle)&&a.removeCollider(C,!0)},[...b,l]);g.useEffect(()=>{const C=M();return u.set(C.handle,hr(C,p.current,l?.ref.current)),()=>{u.delete(C.handle)}},[M]);const I=g.useMemo(()=>N(N({},hn(l?.options)),e),[e,l?.options]);return br(M,I,u),jr(M,I,s,yn(l?.options)),R.createElement("object3D",{position:n,rotation:o,quaternion:r,scale:i,ref:p,name:c},t)}),Ar=R.forwardRef((e,t)=>R.createElement(re,Y({},e,{shape:"cuboid",ref:t})));Ar.displayName="CuboidCollider";const kr=R.forwardRef((e,t)=>R.createElement(re,Y({},e,{shape:"roundCuboid",ref:t})));kr.displayName="RoundCuboidCollider";const Dr=R.forwardRef((e,t)=>R.createElement(re,Y({},e,{shape:"ball",ref:t})));Dr.displayName="BallCollider";const Br=R.forwardRef((e,t)=>R.createElement(re,Y({},e,{shape:"capsule",ref:t})));Br.displayName="CapsuleCollider";const _r=R.forwardRef((e,t)=>R.createElement(re,Y({},e,{shape:"heightfield",ref:t})));_r.displayName="HeightfieldCollider";const Nr=R.forwardRef((e,t)=>R.createElement(re,Y({},e,{shape:"trimesh",ref:t})));Nr.displayName="TrimeshCollider";const zr=R.forwardRef((e,t)=>R.createElement(re,Y({},e,{shape:"cone",ref:t})));zr.displayName="ConeCollider";const Lr=R.forwardRef((e,t)=>R.createElement(re,Y({},e,{shape:"roundCone",ref:t})));Lr.displayName="RoundConeCollider";const Pn=R.forwardRef((e,t)=>R.createElement(re,Y({},e,{shape:"cylinder",ref:t})));Pn.displayName="CylinderCollider";Pn.displayName="RoundCylinderCollider";const Hr=R.forwardRef((e,t)=>R.createElement(re,Y({},e,{shape:"convexHull",ref:t})));Hr.displayName="ConvexHullCollider";const qr=["ref","children","type","position","rotation","scale","quaternion","transformState"],Sn=g.createContext(void 0),xn=()=>g.useContext(Sn),Mn=g.memo(e=>{const{ref:t,children:n,type:o,position:r,rotation:i,scale:c,quaternion:a,transformState:s}=e,u=Ke(e,qr),l=g.useRef(null),d=At(t),{world:p,rigidBodyStates:b,physicsOptions:M,rigidBodyEvents:I}=Je(),C=g.useMemo(()=>N(N(N({},M),e),{},{children:void 0}),[M,e]),v=Rr.flatMap(h=>Array.isArray(C[h])?[...C[h]]:C[h]),f=Tt(l,C),y=En(()=>{const h=xr(C),P=p.createRigidBody(h);return typeof t=="function"&&t(P),d.current=P,P},h=>{p.getRigidBody(h.handle)&&p.removeRigidBody(h)},v);g.useEffect(()=>{const h=y(),P=Mr({rigidBody:h,object:l.current});return b.set(h.handle,e.transformState?e.transformState(P):P),()=>{b.delete(h.handle)}},[y]),Ir(y,C,b),Fr(y,C,I);const x=g.useMemo(()=>({ref:l,getRigidBody:y,options:C}),[y]);return R.createElement(Sn.Provider,{value:x},R.createElement("object3D",Y({ref:l},u,{position:r,rotation:i,quaternion:a,scale:c}),n,f.map((h,P)=>R.createElement(re,Y({key:P},h)))))});Mn.displayName="RigidBody";const Wr=g.memo(e=>{const{children:t,type:n}=e,{physicsOptions:o}=Je(),r=g.useRef(null),{options:i}=xn(),c=g.useMemo(()=>N(N(N({},o),i),{},{children:void 0,colliders:n}),[o,i]),a=Tt(r,c,!1);return R.createElement("object3D",{ref:r,userData:{r3RapierType:"MeshCollider"}},t,a.map((s,u)=>R.createElement(re,Y({key:u},s))))});Wr.displayName="MeshCollider";const Ur=["ref"],Vr=["children","instances","colliderNodes","position","rotation","quaternion","scale"],Gr=g.memo(e=>{let{ref:t}=e,n=Ke(e,Ur);const o=At(t,[]),r=g.useRef(null),i=g.useRef(null),{children:c,instances:a,colliderNodes:s=[],position:u,rotation:l,quaternion:d,scale:p}=n,b=Ke(n,Vr),M=Tt(r,N(N({},n),{},{children:void 0})),I=()=>{const v=i.current.children[0];if(v&&"isInstancedMesh"in v)return v};g.useEffect(()=>{const v=I();v?v.instanceMatrix.setUsage($n):console.warn("InstancedRigidBodies expects exactly one child, which must be an InstancedMesh")},[]);const C=(v,f)=>{const y=I();return y?N(N({},v),{},{getMatrix:x=>(y.getMatrixAt(f,x),x),setMatrix:x=>{y.setMatrixAt(f,x),y.instanceMatrix.needsUpdate=!0},meshType:"instancedMesh"}):v};return R.createElement("object3D",Y({ref:r},b,{position:u,rotation:l,quaternion:d,scale:p}),R.createElement("object3D",{ref:i},c),a?.map((v,f)=>R.createElement(Mn,Y({},b,v,{ref:y=>{o.current[f]=y},transformState:y=>C(y,f)}),R.createElement(R.Fragment,null,s.map((y,x)=>R.createElement(g.Fragment,{key:x},y)),M.map((y,x)=>R.createElement(re,Y({key:x},y)))))))});Gr.displayName="InstancedRigidBodies";export{ti as C,ni as P,Mn as R,fo as _,$r as a,Io as b,Zr as c,Jr as g,an as u};
